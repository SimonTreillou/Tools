#%%
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import curve_fit

# ---------------------------------
# 1) Data
# ---------------------------------
x = np.array([0.3719776813391196, 4.835709857408555, 9.85740855548667, 14.321140731556106,
              17.854928704277743, 21.760694358338498, 25.666460012399256, 29.38623682579045,
              33.663980161190324, 37.011779293242405, 40.7315561066336, 44.4513329200248,
              48.72907625542467, 53.00681959082455, 56.168629882207064, 60.44637321760694,
              64.35213887166769, 67.88592684438933, 73.65158090514569, 78.85926844389336,
              84.06695598264103, 87.97272163670179, 91.87848729076255, 95.78425294482331,
              98.94606323620582, 102.66584004959702, 106.9435833849969, 109.73341599504029,
              113.63918164910105, 116.98698078115312, 120.3347799132052, 124.24054556726595,
              127.7743335399876, 131.68009919404835, 135.02789832610043, 138.74767513949163,
              142.28146311221326, 147.1171729696218, 152.13887166769993, 158.83446993180408,
              164.2281463112213, 169.24984500929943, 174.08555486670798, 178.92126472411655,
              184.1289522628642, 188.59268443893365, 194.35833849969, 199.008059516429,
              203.47179169249844, 207.7495350278983, 212.58524488530688, 216.86298822070674,
              222.44265344079355, 226.16243025418473, 232.11407315561064, 236.76379417234963,
              243.27340359578423, 248.85306881587104, 253.50278983261003, 258.52448853068813,
              265.40607563546183, 271.1717296962182, 276.19342839429635, 282.7030378177309,
              287.3527588344699, 292.1884686918785, 297.39615623062616])

y = np.array([-6.730569948186528, -6.637305699481865, -6.533678756476684, -6.4404145077720205,
              -6.347150259067358, -6.253886010362694, -6.150259067357513, -6.05699481865285,
              -5.932642487046632, -5.860103626943005, -5.766839378238342, -5.66321243523316,
              -5.569948186528498, -5.44559585492228, -5.373056994818652, -5.27979274611399,
              -5.16580310880829, -5.072538860103627, -4.896373056994818, -4.761658031088083,
              -4.585492227979275, -4.461139896373057, -4.3160621761658025, -4.181347150259067,
              -4.046632124352332, -3.901554404145078, -3.715025906735751, -3.569948186528497,
              -3.414507772020725, -3.2694300518134716, -3.1036269430051813, -2.9170984455958546,
              -2.7927461139896375, -2.6269430051813467, -2.471502590673575, -2.336787564766839,
              -2.1917098445595853, -2.05699481865285, -1.8704663212435229, -1.7253886010362693,
              -1.5906735751295331, -1.4870466321243523, -1.404145077720207, -1.3212435233160615,
              -1.2487046632124352, -1.176165803108808, -1.0932642487046627, -1.0103626943005182,
              -0.9481865284974091, -0.8652849740932638, -0.7720207253886011, -0.6683937823834194,
              -0.5544041450777204, -0.47150259067357503, -0.3678756476683933, -0.24352331606217614,
              -0.12953367875647626, -0.02590673575129543, 0.08808290155440446, 0.17098445595854983,
              0.295336787564767, 0.41968911917098506, 0.5233160621761659, 0.6580310880829021,
              0.7512953367875648, 0.8549222797927465, 0.9689119170984455])

# ---------------------------------
# 2) Model: linear trend + Gaussian bar
# ---------------------------------
def model(x, beta, c, A, x0, sigma):
    return beta*x + c + A * np.exp(-(x - x0)**2 / (2*sigma**2))

# ---------------------------------
# 3) Fit
# ---------------------------------
p0 = [-0.02, -5, 0.8, 200, 20]  # initial guess
popt, pcov = curve_fit(model, x, y, p0=p0)

beta, c, A, x0, sigma = popt
print("Fit parameters:")
print(f"beta={beta:.4f}, c={c:.4f},  A={A:.4f},  x0={x0:.2f},  sigma={sigma:.2f}")

# ---------------------------------
# 4) Plot
# ---------------------------------
xx = np.linspace(min(x), max(x), 1000)
#A=A*1.5
yy_IB09 = model(xx, beta, c, A, x0, sigma)
yy_planar = model(xx, beta, c, 0.0, x0, sigma)
yy_sandbar = model(xx, beta, c, A*1.5, x0, sigma*0.3)
yy_terrace = model(xx, beta, c, A*1.5, x0, sigma)

A=A*1.5
plt.figure(figsize=(9,5))
plt.plot(x, y, '.k', label='Idealized IB09')
plt.plot(xx, yy_IB09, '-g',linewidth=2,alpha=0.5, label='Analytical IB09')
#plt.plot(xx, yy_planar, '-r',linewidth=2,alpha=0.5, label='Analytical planar')
plt.plot(xx, yy_sandbar, '-b',linewidth=2,alpha=0.5, label='Analytical sandbar')
#plt.plot(xx, yy_terrace, '-m',linewidth=2,alpha=0.5, label='Analytical sandbar')

sigma=sigma*0.2
#A=A*1.5
yy = model(xx, beta, c, A, x0, sigma)
#plt.plot(xx, yy, '-', label='fit')
plt.hlines(0,xx.min(),xx.max(), colors='gray', linestyles='dashed')
plt.xlabel(r"x [m]")
plt.ylabel(r"y [m]")
plt.legend(loc='center left')
plt.tight_layout()
plt.title(r'$h(x) = \beta x + c + A \exp{\left(-\frac{(x-x_0)^2}{2 \sigma^2}\right)}$'+f' with beta={beta:.3f}, c={c:.2f},  A={A:.1f},  x0={x0:.1f},  sigma={sigma:.1f}',loc='left')
plt.show()

# %%
